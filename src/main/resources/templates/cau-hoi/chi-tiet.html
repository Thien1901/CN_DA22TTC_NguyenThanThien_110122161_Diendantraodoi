<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${cauHoi.tieude + ' - Diá»…n Ä‘Ã n CNTT'}">Chi tiáº¿t cÃ¢u há»i</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/design-system.css}" rel="stylesheet">
    <style>
        .comment-item{background:var(--bg-sunken,#f8f9fa);border-radius:var(--radius-lg);padding:1rem;margin-bottom:1rem;border:1px solid var(--border-default,#e5e7eb)}
        .comment-item:hover{box-shadow:0 2px 8px rgba(0,0,0,.08)}
        .comment-item .reply-form{display:none;margin-top:1rem;padding-top:1rem;border-top:1px solid var(--gray-200)}
        .comment-item .reply-form.show{display:block}
        .comment-replies{margin-left:1.5rem;margin-top:.5rem;padding-left:1rem;border-left:3px solid var(--primary,#3b82f6)}
        .comment-replies .comment-item{background:#fff}
        .btn-reply{font-size:.85rem;color:var(--text-secondary);cursor:pointer}
        .btn-reply:hover{color:var(--primary)}
        .mention-tag{background:rgba(0,102,255,.1);color:var(--primary);padding:.1rem .4rem;border-radius:4px;font-weight:500}
        .question-actions{display:flex;align-items:center;gap:1rem;padding:1rem 0;border-top:1px solid var(--border-subtle);margin-top:1.5rem;flex-wrap:wrap}
        .action-btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:var(--radius-full);font-size:.875rem;font-weight:500;cursor:pointer;border:1px solid var(--border-default);background:var(--bg-elevated);color:var(--text-secondary)}
        .action-btn:hover{background:var(--bg-sunken);color:var(--text-primary)}
        /* Emoji Picker Styles */
        .btn-emoji{position:absolute;right:12px;top:10px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;font-size:1.5rem;color:#fff;cursor:pointer;padding:8px 12px;border-radius:12px;transition:all .3s;box-shadow:0 2px 8px rgba(102,126,234,.3)}
        .btn-emoji:hover{transform:scale(1.1);box-shadow:0 4px 15px rgba(102,126,234,.4)}
        .emoji-picker{display:none;position:absolute;right:0;top:100%;z-index:1000;background:#fff;border:2px solid #e5e7eb;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.2);padding:16px;width:380px;max-height:350px;overflow-y:auto;margin-top:8px}
        .emoji-picker.show{display:block;animation:fadeInUp .2s ease}
        @keyframes fadeInUp{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
        .emoji-picker-header{display:flex;gap:6px;margin-bottom:12px;padding-bottom:12px;border-bottom:2px solid #f3f4f6;justify-content:center}
        .emoji-category-btn{background:#f8f9fa;border:2px solid transparent;font-size:1.5rem;padding:10px 14px;cursor:pointer;border-radius:12px;transition:all .2s}
        .emoji-category-btn:hover{background:#e0e7ff;border-color:#667eea}
        .emoji-category-btn.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-color:transparent;transform:scale(1.05)}
        .emoji-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
        .emoji-item{font-size:1.8rem;padding:10px;cursor:pointer;border-radius:12px;text-align:center;transition:all .15s;background:#f8f9fa}
        .emoji-item:hover{background:#e0e7ff;transform:scale(1.2);box-shadow:0 4px 12px rgba(0,0,0,.1)}
        .btn-emoji-sm{top:6px;right:8px;font-size:1.2rem;padding:6px 10px}
    </style>
</head>
<body>
<div class="toast-container" id="toastContainer"></div>
<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}"><i class="bi bi-chat-square-text-fill"></i>Diá»…n Ä‘Ã n CNTT</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><i class="bi bi-list"></i></button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/}"><i class="bi bi-house"></i>Trang chá»§</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown"><i class="bi bi-grid"></i>Chá»§ Ä‘á»</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" th:href="@{/tat-ca-cau-hoi}"><i class="bi bi-collection"></i>Táº¥t cáº£ cÃ¢u há»i</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li th:each="cd : ${danhSachChuDeGlobal}"><a class="dropdown-item" th:href="@{/chu-de/{ma}(ma=${cd.machude})}" th:text="${cd.tenchude}">Chá»§ Ä‘á»</a></li>
                    </ul>
                </li>
            </ul>
            <form class="d-none d-lg-flex me-3" th:action="@{/tim-kiem}" method="get">
                <div class="search-box"><i class="bi bi-search"></i><input class="form-control" type="search" name="q" placeholder="TÃ¬m kiáº¿m..."></div>
            </form>
            <ul class="navbar-nav align-items-center">
                <li class="nav-item" sec:authorize="hasRole('ADMIN')"><a class="nav-link" th:href="@{/admin}"><i class="bi bi-shield-lock"></i>Quáº£n trá»‹</a></li>
                <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                    <a class="nav-link position-relative" href="#" data-bs-toggle="dropdown" id="notificationDropdown"><i class="bi bi-bell"></i><span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-count" style="display:none">0</span></a>
                    <div class="dropdown-menu dropdown-menu-end notification-dropdown p-0">
                        <div class="notification-header"><div class="d-flex justify-content-between align-items-center"><h6 class="mb-0 fw-semibold">ThÃ´ng bÃ¡o</h6><a href="#" class="text-primary small" onclick="markAllAsRead(event)">Äá»c háº¿t</a></div><div class="d-flex gap-2 mt-3"><button class="btn btn-sm btn-primary tab-btn active" onclick="filterNotifications('all',this)">Táº¥t cáº£</button><button class="btn btn-sm btn-secondary tab-btn" onclick="filterNotifications('unread',this)">ChÆ°a Ä‘á»c</button></div></div>
                        <div id="notification-list" style="max-height:350px;overflow-y:auto"><div class="empty-notification"><i class="bi bi-inbox"></i><p>ChÆ°a cÃ³ thÃ´ng bÃ¡o</p></div></div>
                    </div>
                </li>
                <li class="nav-item me-2" sec:authorize="isAuthenticated()"><a class="btn btn-cta" th:href="@{/cau-hoi/dang-moi}"><i class="bi bi-plus-lg"></i>Äáº·t cÃ¢u há»i</a></li>
                <li class="nav-item" sec:authorize="!isAuthenticated()"><a class="nav-link" th:href="@{/dang-nhap}"><i class="bi bi-box-arrow-in-right"></i>ÄÄƒng nháº­p</a></li>
                <li class="nav-item" sec:authorize="!isAuthenticated()"><a class="btn btn-primary ms-2" th:href="@{/dang-ky}"><i class="bi bi-person-plus"></i>ÄÄƒng kÃ½</a></li>
                <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" data-bs-toggle="dropdown"><img th:if="${currentUser != null}" th:src="${currentUser.anhdaidien != null && !currentUser.anhdaidien.isEmpty()} ? ${currentUser.anhdaidien} : 'https://ui-avatars.com/api/?name=' + ${#strings.replace(currentUser.hoten, ' ', '+')}" class="avatar avatar-sm me-2" alt=""><span sec:authentication="name">User</span></a>
                    <ul class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" th:href="@{/ho-so}"><i class="bi bi-person"></i>Há»“ sÆ¡</a></li><li><hr class="dropdown-divider"></li><li><form th:action="@{/dang-xuat}" method="post" class="m-0"><button type="submit" class="dropdown-item text-danger"><i class="bi bi-box-arrow-right"></i>ÄÄƒng xuáº¥t</button></form></li></ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
<main class="py-5">
    <div class="container">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a th:href="@{/}"><i class="bi bi-house me-1"></i>Trang chá»§</a></li>
                <li class="breadcrumb-item"><a th:href="@{/chu-de/{ma}(ma=${cauHoi.chude?.machude})}" th:text="${cauHoi.chude?.tenchude}">Chá»§ Ä‘á»</a></li>
                <li class="breadcrumb-item active text-truncate" style="max-width:200px" th:text="${cauHoi.tieude}">CÃ¢u há»i</li>
            </ol>
        </nav>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show"><i class="bi bi-exclamation-triangle-fill me-2"></i><span th:text="${error}"></span><button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>
        <div class="question-card mb-4">
            <div class="mb-3"><a th:href="@{/chu-de/{ma}(ma=${cauHoi.chude?.machude})}" class="badge badge-category" th:text="${cauHoi.chude?.tenchude}">Chá»§ Ä‘á»</a></div>
            <h1 class="question-title mb-3" th:text="${cauHoi.tieude}">TiÃªu Ä‘á»</h1>
            <div class="question-meta mb-4">
                <span><i class="bi bi-person"></i><a th:href="@{/ho-so/{id}(id=${cauHoi.manguoidung})}" class="text-decoration-none" th:text="${cauHoi.tennguoidung}">TÃ¡c giáº£</a></span>
                <span th:if="${cauHoi.ngaydang != null}"><i class="bi bi-clock"></i><th:block th:text="${#temporals.format(cauHoi.ngaydang, 'dd/MM/yyyy HH:mm')}"></th:block></span>
                <span><i class="bi bi-eye"></i><th:block th:text="${cauHoi.luotxem != null ? cauHoi.luotxem : 0}">0</th:block> lÆ°á»£t xem</span>
                <span><i class="bi bi-chat"></i><th:block th:text="${cauHoi.soluongbinhluan != null ? cauHoi.soluongbinhluan : 0}">0</th:block> tráº£ lá»i</span>
            </div>
            <hr>
            <div class="question-content" th:utext="${cauHoi.noidung != null ? cauHoi.noidung : 'KhÃ´ng cÃ³ ná»™i dung'}"></div>
            <div th:if="${cauHoi.dinhkem != null && !cauHoi.dinhkem.isEmpty()}" class="mt-4">
                <h6 class="text-secondary"><i class="bi bi-paperclip me-1"></i>ÄÃ­nh kÃ¨m:</h6>
                <div th:each="file : ${cauHoi.dinhkem}" class="mb-3"><a th:href="@{${file}}" target="_blank"><img th:src="@{${file}}" class="img-fluid rounded" style="max-width:100%;max-height:400px;" alt="áº¢nh"></a></div>
            </div>
            <div class="question-actions">
                <div class="ms-auto d-flex gap-2">
                    <button th:if="${isLoggedIn and !isOwner}" class="action-btn" onclick="openReportModal('CAUHOI')"><i class="bi bi-flag"></i><span class="d-none d-sm-inline">BÃ¡o cÃ¡o</span></button>
                    <th:block th:if="${isOwner or isAdmin}">
                        <a th:href="@{/cau-hoi/{id}/sua(id=${cauHoi.id})}" class="action-btn"><i class="bi bi-pencil"></i><span class="d-none d-sm-inline">Sá»­a</span></a>
                        <form th:action="@{/cau-hoi/{id}/xoa(id=${cauHoi.id})}" method="post" class="d-inline" onsubmit="return confirm('XÃ³a cÃ¢u há»i nÃ y?')"><button type="submit" class="action-btn" style="color:var(--error)"><i class="bi bi-trash"></i><span class="d-none d-sm-inline">XÃ³a</span></button></form>
                    </th:block>
                </div>
            </div>
        </div>
        <hr class="my-4">
        <h5 class="fw-semibold mb-4"><i class="bi bi-chat-dots me-2 text-primary"></i>CÃ¢u tráº£ lá»i (<span th:text="${cauHoi.soluongbinhluan}">0</span>)</h5>
 
       <!-- Comments List -->
        <div th:if="${cauTraLois != null && !cauTraLois.isEmpty()}" id="comments-container">
            <th:block th:each="traloi : ${cauTraLois}">
                <div class="comment-item" th:id="'comment-' + ${traloi.macautraloi}">
                    <div class="d-flex">
                        <div class="me-3"><img th:src="${traloi.anhdaidien != null && !traloi.anhdaidien.isEmpty()} ? ${traloi.anhdaidien} : 'https://ui-avatars.com/api/?name=' + ${#strings.replace(traloi.tennguoidung, ' ', '+')}" class="avatar avatar-sm" alt=""></div>
                        <div class="flex-grow-1">
                            <div><strong th:text="${traloi.tennguoidung}">NgÆ°á»i tráº£ lá»i</strong><small class="text-secondary ms-2" th:if="${traloi.ngaytraloi != null}" th:text="${#temporals.format(traloi.ngaytraloi, 'dd/MM/yyyy HH:mm')}"></small></div>
                            <div class="mt-2 mb-2" th:utext="${traloi.noidung}"></div>
                            <div th:if="${traloi.dinhkem != null && !traloi.dinhkem.isEmpty()}" class="d-flex flex-wrap gap-2 mb-2">
                                <a th:each="img : ${traloi.dinhkem}" th:href="@{${img}}" target="_blank"><img th:src="@{${img}}" class="rounded" style="max-width:150px;max-height:150px;object-fit:cover;" alt=""></a>
                            </div>
                            <div class="d-flex gap-3" th:if="${isLoggedIn}">
                                <span class="btn-reply" th:attr="onclick='toggleReplyForm(\'' + ${traloi.macautraloi} + '\')'"><i class="bi bi-reply me-1"></i>Tráº£ lá»i</span>
                                <form th:if="${currentUser != null and (currentUser.manguoidung == traloi.manguoidung or isAdmin)}" th:action="@{/cau-hoi/{cauhoiId}/tra-loi/{id}/xoa(cauhoiId=${cauHoi.id}, id=${traloi.macautraloi})}" method="post" class="d-inline" onsubmit="return confirm('XÃ³a bÃ¬nh luáº­n nÃ y?')">
                                    <button type="submit" class="btn-reply text-danger" style="border:none;background:none;padding:0;cursor:pointer"><i class="bi bi-trash me-1"></i>XÃ³a</button>
                                </form>
                            </div>
                            <div class="reply-form" th:id="'reply-form-' + ${traloi.macautraloi}" th:if="${isLoggedIn}">
                                <form th:action="@{/cau-hoi/{cauhoiId}/tra-loi/{traloiId}/phan-hoi(cauhoiId=${cauHoi.id}, traloiId=${traloi.macautraloi})}" method="post" enctype="multipart/form-data">
                                    <div class="mb-2 position-relative">
                                        <textarea name="noidung" th:id="'textarea-' + ${traloi.macautraloi}" class="form-control" rows="2" th:placeholder="'Tráº£ lá»i ' + ${traloi.tennguoidung} + '...'" required></textarea>
                                        <button type="button" class="btn-emoji btn-emoji-sm" th:attr="onclick='toggleEmojiPicker(\'textarea-' + ${traloi.macautraloi} + '\', \'emoji-' + ${traloi.macautraloi} + '\')'"><i class="bi bi-emoji-smile"></i></button>
                                        <div th:id="'emoji-' + ${traloi.macautraloi}" class="emoji-picker"></div>
                                    </div>
                                    <div class="mb-2"><input type="file" name="hinhAnh" class="form-control form-control-sm" accept="image/*" multiple th:attr="onchange='previewImages(this, \'preview-' + ${traloi.macautraloi} + '\')'"><div th:id="'preview-' + ${traloi.macautraloi}" class="d-flex flex-wrap gap-1 mt-1"></div></div>
                                    <div class="d-flex gap-2"><button type="submit" class="btn btn-primary btn-sm"><i class="bi bi-send me-1"></i>Gá»­i</button><button type="button" class="btn btn-secondary btn-sm" th:attr="onclick='toggleReplyForm(\'' + ${traloi.macautraloi} + '\')'">Há»§y</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- Nested Replies -->
                    <div th:if="${traloi.cacTraLoiCon != null && !traloi.cacTraLoiCon.isEmpty()}" class="comment-replies">
                        <th:block th:each="traloiCon : ${traloi.cacTraLoiCon}">
                            <div class="comment-item" th:id="'comment-' + ${traloiCon.macautraloi}">
                                <div class="d-flex">
                                    <div class="me-3"><img th:src="${traloiCon.anhdaidien != null && !traloiCon.anhdaidien.isEmpty()} ? ${traloiCon.anhdaidien} : 'https://ui-avatars.com/api/?name=' + ${#strings.replace(traloiCon.tennguoidung, ' ', '+')}" class="avatar avatar-sm" alt=""></div>
                                    <div class="flex-grow-1">
                                        <div><strong th:text="${traloiCon.tennguoidung}">NgÆ°á»i tráº£ lá»i</strong><span th:if="${traloiCon.tenNguoiDuocTraLoi != null}" class="ms-1"><i class="bi bi-arrow-right-short"></i><span class="mention-tag" th:text="'@' + ${traloiCon.tenNguoiDuocTraLoi}"></span></span><small class="text-secondary ms-2" th:if="${traloiCon.ngaytraloi != null}" th:text="${#temporals.format(traloiCon.ngaytraloi, 'dd/MM/yyyy HH:mm')}"></small></div>
                                        <div class="mt-2 mb-2" th:utext="${traloiCon.noidung}"></div>
                                        <div th:if="${traloiCon.dinhkem != null && !traloiCon.dinhkem.isEmpty()}" class="d-flex flex-wrap gap-2 mb-2">
                                            <a th:each="img : ${traloiCon.dinhkem}" th:href="@{${img}}" target="_blank"><img th:src="@{${img}}" class="rounded" style="max-width:150px;max-height:150px;object-fit:cover;" alt=""></a>
                                        </div>
                                        <div class="d-flex gap-3" th:if="${isLoggedIn}">
                                            <span class="btn-reply" th:attr="onclick='toggleReplyForm(\'' + ${traloiCon.macautraloi} + '\')'"><i class="bi bi-reply me-1"></i>Tráº£ lá»i</span>
                                            <form th:if="${currentUser != null and (currentUser.manguoidung == traloiCon.manguoidung or isAdmin)}" th:action="@{/cau-hoi/{cauhoiId}/tra-loi/{id}/xoa(cauhoiId=${cauHoi.id}, id=${traloiCon.macautraloi})}" method="post" class="d-inline" onsubmit="return confirm('XÃ³a bÃ¬nh luáº­n nÃ y?')">
                                                <button type="submit" class="btn-reply text-danger" style="border:none;background:none;padding:0;cursor:pointer"><i class="bi bi-trash me-1"></i>XÃ³a</button>
                                            </form>
                                        </div>
                                        <div class="reply-form" th:id="'reply-form-' + ${traloiCon.macautraloi}" th:if="${isLoggedIn}">
                                            <form th:action="@{/cau-hoi/{cauhoiId}/tra-loi/{traloiId}/phan-hoi(cauhoiId=${cauHoi.id}, traloiId=${traloiCon.macautraloi})}" method="post" enctype="multipart/form-data">
                                                <div class="mb-2 position-relative">
                                                    <textarea name="noidung" th:id="'textarea-' + ${traloiCon.macautraloi}" class="form-control" rows="2" th:placeholder="'Tráº£ lá»i ' + ${traloiCon.tennguoidung} + '...'" required></textarea>
                                                    <button type="button" class="btn-emoji btn-emoji-sm" th:attr="onclick='toggleEmojiPicker(\'textarea-' + ${traloiCon.macautraloi} + '\', \'emoji-' + ${traloiCon.macautraloi} + '\')'"><i class="bi bi-emoji-smile"></i></button>
                                                    <div th:id="'emoji-' + ${traloiCon.macautraloi}" class="emoji-picker"></div>
                                                </div>
                                                <div class="mb-2"><input type="file" name="hinhAnh" class="form-control form-control-sm" accept="image/*" multiple th:attr="onchange='previewImages(this, \'preview-' + ${traloiCon.macautraloi} + '\')'"><div th:id="'preview-' + ${traloiCon.macautraloi}" class="d-flex flex-wrap gap-1 mt-1"></div></div>
                                                <div class="d-flex gap-2"><button type="submit" class="btn btn-primary btn-sm"><i class="bi bi-send me-1"></i>Gá»­i</button><button type="button" class="btn btn-secondary btn-sm" th:attr="onclick='toggleReplyForm(\'' + ${traloiCon.macautraloi} + '\')'">Há»§y</button></div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th:block>
                    </div>
                </div>
            </th:block>
        </div>
        <div th:if="${cauTraLois == null || cauTraLois.isEmpty()}" class="text-center py-4"><i class="bi bi-chat display-4 text-muted"></i><p class="text-muted mt-3">ChÆ°a cÃ³ cÃ¢u tráº£ lá»i nÃ o</p></div>
        <hr class="my-4" th:if="${isLoggedIn}">
        <!-- Form viáº¿t cÃ¢u tráº£ lá»i -->
        <div th:if="${isLoggedIn}" class="row">
            <div class="col-lg-8">
                <h5 class="fw-semibold mb-3"><i class="bi bi-reply me-2 text-primary"></i>Viáº¿t cÃ¢u tráº£ lá»i</h5>
                <form th:action="@{/cau-hoi/{id}/tra-loi(id=${cauHoi.id})}" method="post" enctype="multipart/form-data">
                    <div class="mb-3 position-relative">
                        <textarea name="noidung" id="mainCommentTextarea" class="form-control" rows="3" placeholder="Nháº­p cÃ¢u tráº£ lá»i..."></textarea>
                        <button type="button" class="btn btn-emoji" onclick="toggleEmojiPicker('mainCommentTextarea', 'mainEmojiPicker')"><i class="bi bi-emoji-smile"></i></button>
                        <div id="mainEmojiPicker" class="emoji-picker"></div>
                    </div>
                    <div class="mb-3"><label class="form-label text-muted small"><i class="bi bi-image me-1"></i>ÄÃ­nh kÃ¨m hÃ¬nh áº£nh</label><input type="file" name="hinhAnh" class="form-control" accept="image/*" multiple onchange="previewImages(this, 'mainPreview')"><div id="mainPreview" class="d-flex flex-wrap gap-2 mt-2"></div></div>
                    <div class="d-flex justify-content-end"><button type="submit" class="btn btn-cta"><i class="bi bi-send me-2"></i>Gá»­i tráº£ lá»i</button></div>
                </form>
            </div>
        </div>
        <div th:if="${!isLoggedIn}" class="text-center py-3"><p class="text-secondary mb-2">Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ tráº£ lá»i</p><a th:href="@{/dang-nhap}" class="btn btn-primary"><i class="bi bi-box-arrow-in-right me-2"></i>ÄÄƒng nháº­p</a></div>
    </div>
</main>
<!-- M
odal BÃ¡o cÃ¡o -->
<div class="modal fade" id="reportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title"><i class="bi bi-flag me-2 text-warning"></i>BÃ¡o cÃ¡o</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <input type="hidden" id="reportType"><input type="hidden" id="reportTargetId" th:value="${cauHoi.id}">
                <div class="mb-3"><label class="form-label fw-semibold">LÃ½ do <span class="text-danger">*</span></label><select class="form-select" id="reportReason"><option value="">-- Chá»n lÃ½ do --</option><option value="SPAM">Spam</option><option value="NOI_DUNG_KHONG_PHU_HOP">Ná»™i dung khÃ´ng phÃ¹ há»£p</option><option value="NGON_TU_XUC_PHAM">NgÃ´n tá»« xÃºc pháº¡m</option><option value="THONG_TIN_SAI_LECH">ThÃ´ng tin sai lá»‡ch</option><option value="KHAC">KhÃ¡c</option></select></div>
                <div class="mb-3"><label class="form-label fw-semibold">MÃ´ táº£</label><textarea class="form-control" id="reportDescription" rows="3" placeholder="MÃ´ táº£ chi tiáº¿t..."></textarea></div>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Há»§y</button><button type="button" class="btn btn-warning" onclick="submitReport()"><i class="bi bi-send me-1"></i>Gá»­i</button></div>
        </div>
    </div>
</div>
<!-- Modal Káº¿t quáº£ -->
<div class="modal fade" id="resultModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center">
            <div class="modal-body py-5"><div id="resultIcon" class="mb-3" style="font-size:4rem"></div><h4 id="resultTitle" class="mb-3"></h4><p id="resultMessage" class="text-muted mb-4"></p><button type="button" class="btn btn-primary px-4" data-bs-dismiss="modal">ÄÃ³ng</button></div>
        </div>
    </div>
</div>
<footer class="footer"><div class="container"><div class="row g-4"><div class="col-lg-5"><h5><i class="bi bi-chat-square-text-fill me-2"></i>Diá»…n Ä‘Ã n CNTT</h5><p>Ná»n táº£ng trao Ä‘á»•i kiáº¿n thá»©c chuyÃªn ngÃ nh.</p></div><div class="col-lg-3"><h6>LiÃªn káº¿t</h6><ul class="list-unstyled"><li><a th:href="@{/}">Trang chá»§</a></li><li><a th:href="@{/tat-ca-cau-hoi}">Táº¥t cáº£ cÃ¢u há»i</a></li></ul></div><div class="col-lg-4"><h6>ThÃ´ng tin</h6><ul class="list-unstyled"><li>SV: Nguyá»…n Thanh ThiÃªn</li><li>MSSV: 110122161</li></ul></div></div><hr><p class="text-center mb-0">Â© 2025 Diá»…n Ä‘Ã n CNTT</p></div></footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/chi-tiet.js}"></script>
<script>
// Emoji Picker
const emojiCategories = {
    'smileys': ['ğŸ˜€','ğŸ˜ƒ','ğŸ˜„','ğŸ˜','ğŸ˜†','ğŸ˜…','ğŸ¤£','ğŸ˜‚','ğŸ™‚','ğŸ˜Š','ğŸ˜‡','ğŸ¥°','ğŸ˜','ğŸ¤©','ğŸ˜˜','ğŸ˜—','ğŸ˜š','ğŸ˜‹','ğŸ˜›','ğŸ˜œ','ğŸ¤ª','ğŸ˜','ğŸ¤‘','ğŸ¤—','ğŸ¤­','ğŸ¤«','ğŸ¤”','ğŸ¤','ğŸ¤¨','ğŸ˜','ğŸ˜‘','ğŸ˜¶','ğŸ˜','ğŸ˜’','ğŸ™„','ğŸ˜¬','ğŸ¤¥','ğŸ˜Œ','ğŸ˜”','ğŸ˜ª','ğŸ¤¤','ğŸ˜´','ğŸ˜·','ğŸ¤’','ğŸ¤•','ğŸ¤¢','ğŸ¤®','ğŸ¤§','ğŸ¥µ','ğŸ¥¶','ğŸ¥´','ğŸ˜µ','ğŸ¤¯','ğŸ¤ ','ğŸ¥³','ğŸ˜','ğŸ¤“','ğŸ§'],
    'gestures': ['ğŸ‘','ğŸ‘','ğŸ‘Œ','ğŸ¤Œ','ğŸ¤','âœŒï¸','ğŸ¤','ğŸ¤Ÿ','ğŸ¤˜','ğŸ¤™','ğŸ‘ˆ','ğŸ‘‰','ğŸ‘†','ğŸ‘‡','â˜ï¸','ğŸ‘‹','ğŸ¤š','ğŸ–ï¸','âœ‹','ğŸ––','ğŸ‘','ğŸ™Œ','ğŸ‘','ğŸ¤²','ğŸ¤','ğŸ™','âœï¸','ğŸ’ª','ğŸ¦¾','ğŸ¦¿'],
    'hearts': ['â¤ï¸','ğŸ§¡','ğŸ’›','ğŸ’š','ğŸ’™','ğŸ’œ','ğŸ–¤','ğŸ¤','ğŸ¤','ğŸ’”','â£ï¸','ğŸ’•','ğŸ’','ğŸ’“','ğŸ’—','ğŸ’–','ğŸ’˜','ğŸ’','ğŸ’Ÿ'],
    'objects': ['ğŸ’»','ğŸ“±','ğŸ’¡','ğŸ“š','ğŸ“–','âœï¸','ğŸ“','ğŸ“Œ','ğŸ“','ğŸ”—','ğŸ’¾','ğŸ’¿','ğŸ®','ğŸ¯','ğŸ†','ğŸ‰','ğŸŠ','ğŸ','ğŸ”¥','â­','âœ¨','ğŸ’«','ğŸŒŸ','âš¡','ğŸ’¥','ğŸ’¢','ğŸ’¯','âœ…','âŒ','â“','â—','âš ï¸','ğŸ””','ğŸ”’','ğŸ”“'],
    'nature': ['ğŸŒ¸','ğŸŒº','ğŸŒ»','ğŸŒ¹','ğŸŒ·','ğŸŒ±','ğŸŒ²','ğŸŒ³','ğŸ€','ğŸ','ğŸ‚','ğŸŒˆ','â˜€ï¸','ğŸŒ™','â­','â˜ï¸','ğŸŒ§ï¸','â›ˆï¸','â„ï¸','ğŸ”¥','ğŸ’§','ğŸŒŠ']
};
const categoryIcons = {'smileys':'ğŸ˜€','gestures':'ğŸ‘','hearts':'â¤ï¸','objects':'ğŸ’»','nature':'ğŸŒ¸'};
let currentCategory = 'smileys';

function createEmojiPicker(pickerId) {
    const picker = document.getElementById(pickerId);
    if (!picker || picker.dataset.initialized) return;
    picker.dataset.initialized = 'true';
    let html = '<div class="emoji-picker-header">';
    for (const [cat, icon] of Object.entries(categoryIcons)) {
        html += `<button type="button" class="emoji-category-btn ${cat === 'smileys' ? 'active' : ''}" data-category="${cat}" onclick="switchCategory('${pickerId}', '${cat}')">${icon}</button>`;
    }
    html += '</div><div class="emoji-grid" id="' + pickerId + '-grid">';
    emojiCategories['smileys'].forEach(e => { html += `<span class="emoji-item" onclick="insertEmoji(this, '${pickerId}')">${e}</span>`; });
    html += '</div>';
    picker.innerHTML = html;
}

function switchCategory(pickerId, category) {
    const picker = document.getElementById(pickerId);
    picker.querySelectorAll('.emoji-category-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.category === category));
    const grid = document.getElementById(pickerId + '-grid');
    grid.innerHTML = emojiCategories[category].map(e => `<span class="emoji-item" onclick="insertEmoji(this, '${pickerId}')">${e}</span>`).join('');
}

function toggleEmojiPicker(textareaId, pickerId) {
    const picker = document.getElementById(pickerId);
    createEmojiPicker(pickerId);
    picker.classList.toggle('show');
    picker.dataset.textarea = textareaId;
}

function insertEmoji(el, pickerId) {
    const picker = document.getElementById(pickerId);
    const textarea = document.getElementById(picker.dataset.textarea);
    if (textarea) {
        const start = textarea.selectionStart, end = textarea.selectionEnd;
        textarea.value = textarea.value.substring(0, start) + el.textContent + textarea.value.substring(end);
        textarea.selectionStart = textarea.selectionEnd = start + el.textContent.length;
        textarea.focus();
    }
}

// Close emoji picker when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('.emoji-picker') && !e.target.closest('.btn-emoji')) {
        document.querySelectorAll('.emoji-picker.show').forEach(p => p.classList.remove('show'));
    }
});
</script>
<script>
// Kiá»ƒm tra query param Ä‘á»ƒ hiá»‡n toast
(function() {
    var params = new URLSearchParams(window.location.search);
    if (params.get('commented') === '1') {
        setTimeout(function() { showToast('success', 'ThÃ nh cÃ´ng', 'ÄÃ£ gá»­i cÃ¢u tráº£ lá»i!'); }, 300);
        history.replaceState(null, '', window.location.pathname + window.location.hash);
    }
    if (params.get('replied') === '1') {
        setTimeout(function() { showToast('success', 'ThÃ nh cÃ´ng', 'ÄÃ£ gá»­i pháº£n há»“i!'); }, 300);
        history.replaceState(null, '', window.location.pathname + window.location.hash);
    }
    if (params.get('deleted') === '1') {
        setTimeout(function() { showToast('success', 'ThÃ nh cÃ´ng', 'ÄÃ£ xÃ³a bÃ¬nh luáº­n!'); }, 300);
        history.replaceState(null, '', window.location.pathname + window.location.hash);
    }
})();
</script>
</body>
</html>